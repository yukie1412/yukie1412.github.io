var app=angular.module("gwcMills",["ui.router","ui.bootstrap"]);app.controller("gwcMain",["$scope",function(e){"use strict";e.classModule=""}]).filter({toHTML:["$sce",function(e){"use strict";return function(t){return e.trustAsHtml(t)}}]}),app.constant("CONTENT_ROUTE",[{name:"main",title:"Girls Who Code",url:"/",views:{"@":{templateUrl:"home.html"}}},{name:"variables",url:"/variables",views:{"@":{templateUrl:"variables/variable-types.html",controller:"varTypeCtrl"}}},{name:"operations",url:"/operations",children:[{name:"summary",url:"/summary"},{name:"symbol",url:"/symbol",views:{"@":{templateUrl:"operations/symbols.html",controller:"opSymbolCtrl"}}},{name:"try",url:"/try",views:{"@":{templateUrl:"operations/try.html",controller:"opTryCtrl"}}}]},{name:"game",url:"/game",views:{"@":{templateUrl:"game/main-interface.html",controller:"gameCtrl"}}}]),app.config(["$stateProvider","$urlRouterProvider","$locationProvider","CONTENT_ROUTE",function(e,t,a,n){"use strict";function o(t,a){_.forEach(t,function(t){var n=a+"."+t.name;e.state(n,t),_.has(t,"children")&&o(t.children,n)})}_.forEach(n,function(t){e.state(t,t.name),o(t.children,t.name)}),t.otherwise("404"),a.html5Mode(!0)}]),app.controller("gameCtrl",["$scope","$timeout","$interval","$uibModal","VARIABLE_PROPERTIES","INSTRUCTIONS",function(e,t,a,n,o,r){"use strict";function s(t,a){delete t.message,e.cat[t.name]={value:a,text:t.text}}function i(){0===e.cat.happiness.value&&(a.cancel(m),e.gameSetting.lost=!0)}function l(t){e.modal={questions:[]},f=n.open({templateUrl:"game/game-modal.html",backdrop:"static",scope:e}),d=t,h=!0}function p(){2!==e.gameSetting.page||h||(_.isEmpty(e.messages)||e.messages.shift(),0===e.timer?(e.timer=10,e.cat.happiness.value--,e.cat.coins.value+=2,e.messages.push("happiness--"),e.messages.push("coins += 2"),i(),0!==c?c--:e.showerCat(!0),e.gameSetting.petCycle>0&&e.gameSetting.petCycle--):e.timer--)}function u(t,a,n,o){var r=[],s="+"===n?"increased":"reduced";1===a&&r.push(t+n+n+";"),r.push(t+" "+n+"= "+a+";"),r.push(t+" = "+t+" "+n+" "+a+";"),e.modal.questions.push({q:"<code>"+t+"</code> is "+s+" by <code>"+a+"</code>",name:o,answers:r})}e.catLists=["blackCat.png","blueCat.png","brownCat.png","greyCat.png","whiteCat.png","yellowCat.png"],e.variableProperties=_.cloneDeep(o),e.gameInstructions=_.cloneDeep(r),e.messages=[];var m,c,h,d,f,v=/^var [a-zA-Z]+ = [a-zA-Z0-9-\.\"]+;$/,y=e.gameInstructions.length;e.closeModal=function(){h=!1,f.dismiss("cancel")},e.reset=function(){e.cat={inventory:{food:1,toy:1}},e.variableDefinitions={},e.timer=10,e.gameSetting={page:0,petCycle:0},c=5},e.noMessages=function(){var t=!0;return _.some(e.variableProperties,function(e){if(e.message)return void(t=!1)}),t},e.verifyInput=function(t,a){if(!e.variableDefinitions[t.name])return a[t.formName].$setDirty(),void(t.message="This field is required.");var n=e.variableDefinitions[t.name];if(_.isNull(n.match(v)))return void(t.message="Check your syntax.");try{if(window.eval(n),!_.has(window,t.name))return void(t.message=t.name+" is undefined");var o=window[t.name];if("number"==typeof o&&("integer"===t.type||"double"===t.type))return"integer"===t.type&&o!==parseInt(o)?void(t.message="Value of "+t.name+" must be an integer"):o>t.max||o<t.min?void(t.message="Value of "+t.name+" must be between "+t.min+" and "+t.max):void s(t,o);if(typeof o===t.type)return void s(t,o);t.message="Value of "+t.name+" must be a "+t.type}catch(e){t.message="Invalid input."}},e.getHelp=function(){e.gameSetting.help=!0,h=!0,e.gameSetting.helpStep=0},e.nextHelpHint=function(){e.gameSetting.helpStep++,e.gameSetting.helpStep===y&&e.closeHelp()},e.closeHelp=function(){m||(m=a(p,1e3)),e.gameSetting.help=!1,h=!1},e.showerCat=function(t){t||(l("showerCat"),u("happiness",e.cat.shower.value,"-","shower"))},e.petCat=function(){l("petCat"),u("happiness",e.cat.pet.value,"+","pet")},e.addInventory=function(t){l("addInventory"),u("coins",e.cat[t].value,"-","coin"),u(t,1,"+",t),e.modal.type=t},e.useInventory=function(t,a){l("useInventory"),u("happiness",e.cat[t].value,"+",t),u(a,1,"-",a),e.modal.type=a,e.modal.action=t},e.confirmAnswer=function(){e.gameSetting.verifyAnswer="";var t=[];if(_.forEach(e.modal.questions,function(e,a){e.answers.indexOf(e.a)===-1&&t.push(a+1)}),_.isEmpty(t)){e.closeModal(!0);var a,n;switch(e.messages.push(""),d){case"useInventory":a=e.modal.type,n=e.modal.action,e.cat.inventory[a]--,e.cat.happiness.value+=e.cat[n].value,e.messages.push(a+"--"),e.messages.push("happiness += "+e.cat[n].value);break;case"addInventory":if(a=e.modal.type,e.cat.coins.value<e.cat[a].value)return void e.messages.push("Not enough money :(");e.cat.inventory[a]++,e.cat.coins.value-=e.cat[a].value,e.messages.push(a+"++"),e.messages.push("coins -= "+e.cat[a].value);break;case"petCat":e.cat.happiness.value+=e.cat.pet.value,e.gameSetting.petCycle=5,e.messages.push("happiness += "+e.cat.pet.value);break;case"showerCat":e.cat.happiness.value-=e.cat.shower.value,e.messages.push("happiness -= "+e.cat.shower.value),c=5,i()}}else e.gameSetting.verifyAnswer="Verify your answer for #"+t.join(",")},e.reset()}]),app.constant("INSTRUCTIONS",[{style:"top: 0; left: 70px;",rules:["This is the help button. It'll walk through all the game rules.","You may press the 'x' on the top-right-corner to stop it anytime.","Press the 'Next' button to proceed to the next rule."]},{style:"top: 50px; left: 40%;",rules:["This is a countdown timer.","<code>happiness--</code> everytime it becomes 0.","<code>coins += 2</code> everytime it becomes 0."]},{style:"top: 80px; right: 150px;",rules:["This is your pet's current happiness level.","You will lose when happiness level becomes 0."]},{style:"top: 80px; right: 10px;",rules:["This is your money.","You'll need it to buy inventories for your pet."]},{style:"top: 180px; left: 120px;",rules:["This is your Inventory: Food & Toy","To start-off, you are given 1 food & 1 toy for free!","Click on the item to add to your inventory."]},{style:"top: 250px; right: 90px;",rules:["These are the actions you can do with your pet.","It will change the happiness of your pet.","Cilck on the item to interact with your pet.","Shower is automatically done every 5 cycles.","You can only pet your cat once every 5 cycles."]},{style:"top: 250px; left: 30%;",rules:["Your pet is already at the playground.","Click 'Next' to start the game!","Remember actions only take effect when you correctly answered the question!"]}]),app.constant("VARIABLE_PROPERTIES",[{name:"petName",text:"name",formName:"nameInput",type:"string",description:"Name of your pet"},{name:"isFemale",text:"gender",formName:"genderInput",type:"boolean",description:"Is your cat a girl or a boy?"},{name:"happiness",text:"initial happiness",formName:"happinessInput",type:"integer",description:"Initial happiness level of your pet. Must be an integer between 20 and 50.",max:50,min:20},{name:"eat",text:"food reward",formName:"eatInput",type:"integer",description:"Amount of happiness your pet gains after eating. Must be an integer between 1 and 5.",min:1,max:5},{name:"play",text:"play reward",formName:"playInput",type:"integer",description:"Amount of happiness your pet gains after playing. Must be an integer between 1 and 5.",min:1,max:5},{name:"pet",text:"pet reward",formName:"petInput",type:"integer",description:"Amount of happiness your pet gains after being petted. Must be an integer between 1 and 3.",min:1,max:3},{name:"shower",text:"shower penalty",formName:"showerInput",type:"integer",description:"Amount of happiness your pet loses after a shower. Must be an integer between 3 and 8.",min:3,max:8},{name:"coins",text:"money",formName:"coinsInput",type:"double",description:"Amount of money you have to start the game. Must be a double between 20 and 50.",max:50,min:20},{name:"food",text:"food cost",formName:"foodInput",type:"number",restriction:"double",description:"Cost to feed your pet. Must be a double between 3 and 8.",min:3,max:8},{name:"toy",text:"toy cost",formName:"toyInput",type:"double",description:"Cost to play with your pet. Must be a double between 3 and 8.",min:3,max:8}]),app.controller("opSymbolCtrl",["$scope",function($scope){"use strict";function _limitDecimalPlace(e){if(Math.floor(e)!==e){var t=e.toString().split(".")[1].length;t>5&&(e=Number(e).toFixed(5))}return e}function _evaluate(op){return eval(a+op+b)}var opIdx="",a,b,res;$scope.operations=["+","-","*","/","%"],$scope.reset=function(){a=Math.ceil(50*Math.random()),b=Math.ceil(50*Math.random()),opIdx=Math.floor(Math.random()*$scope.operations.length),res=_evaluate($scope.operations[opIdx]),res=_limitDecimalPlace(res);var e=a+" ___ "+b+" = "+res;$scope.variable={value:e,message:0,symbol:""}},$scope.verifyAnswer=function(){if(delete $scope.variable.message,$scope.variable.result=$scope.operations[opIdx]===$scope.variable.symbol,$scope.variable.result)return void($scope.variable.value=$scope.variable.value.replace("___",$scope.variable.symbol));var e=_evaluate($scope.variable.symbol);e===res&&($scope.variable.message="Correct! But there is another answer. Can you spot it?")},$scope.reset()}]),app.controller("opTryCtrl",["$scope",function(e){"use strict";function t(e){var t="name"===e?n:r,s=Math.floor(Math.random()*t);return"name"===e?a[s]:o[s]}var a="abcdefghijklmnopqrstuvwxyz".split(""),n=a.length,o=["+","-","*","/","%","++","--"],r=o.length;e.reset=function(a){a&&a.$setPristine(),e.answer=void 0,e.first={name:t("name")},e.op={name:t("operator")},e.second="++"!==e.op.name&&"--"!==e.op.name?{name:t("name")}:void 0},e.validateInput=function(t){if(!_.has(e[t],"value"))return!0;try{var a=e[t].value;window.eval(a);var n=e[t].name;if(!_.has(window,n))return e[t].message=n+" is undefined",!1;var o=window[n];return"number"!=typeof o?(e[t].message=n+" is not a number",!1):(delete e[t].message,e[t].num=o,!0)}catch(a){return e[t].message="Incorrect JavaScript format",!1}},e.getAnswer=function(){var t;if(e.second){t=e.first.num+" "+e.op.name+" "+e.second.num;var a=window.eval(t);e.answer=e.first.name+" "+e.op.name+" "+e.second.name+" = "+a}else t=e.first.num+e.op.name,window.eval(e.op.value),e.answer=e.first.name+" becomes "+window[e.first.name]},e.reset()}]),app.controller("varTypeCtrl",["$scope",function(e){"use strict";function t(){var e=Math.floor(100*Math.random());return!!(e%2)}function a(e){var t="integer"===e?0:Math.floor(10*Math.random()+1),a=100*Math.random();return Number(a).toFixed(t)}function n(){var n=Math.floor(3*Math.random());if(o=e.optionKeys[n],"boolean"===o)return t();if("integer"===o||"double"===o)return a(o);var s=Math.floor(Math.random()*l+2),i="";return i=s===l?t():s>l?a("double"):r[s],'"'+i+'"'}var o="",r="abcdefghijklmnopqrstuvwxyz ;:?/.>,<!@#$%^&*()_-=+[]{}".split(""),s=["Do you see quotes around the variables?","Is it true or false?","Is it a word?","Does it have a decimal point?","Is this a numeric value?"],i=s.length,l=r.length;e.optionKeys=["integer","double","string","boolean"],e.verifyAnswer=function(){return e.variable.message=1,e.variable.result=o===e.variable.type,e.variable.result},e.reset=function(){e.variable={value:n(),message:0,type:""}},e.getHelp=function(){var e=Math.floor(Math.random()*i);return s[e]},e.reset()}]);